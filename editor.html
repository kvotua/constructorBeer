<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pumpkin Ale</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/CustomEase.min.js"></script>
    <script src="https://unpkg.com/lenis@1.0.45/dist/lenis.min.js"></script>
    <link
      href="https://fonts.cdnfonts.com/css/copperplate-cyrillic"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles/base.css" />
    <link rel="stylesheet" href="styles/editor.css" />
  </head>
  <body>
    <div class="logo">
      <img src="./assets/ponarth.svg" alt="Pumpkin Ale Logo" />
    </div>

    <div class="container">
      <div class="header">
        <div class="header__illustration">
          <img
            src="https://i.ibb.co/MkxRwWdC/photo-2024-11-23-20-27-20.jpg"
            alt="Pumpkin Illustration"
          />
          <button id="editPic" class="edit-btn">
            <img src="./assets/edit.svg" alt="" class="edit-btn__img" />
          </button>
        </div>
        <button
          id="togglePic"
          class="toggle-btn-img"
          title="Скрыть изображение"
        >
          &mdash;
        </button>
        <h1 class="header__title">
          Pumpkin <br />
          Ale<button id="editTitle" class="edit-btn">
            <img src="./assets/edit.svg" alt="" class="edit-btn__img" />
          </button>
        </h1>
        <div class="header__credits">
          <p class="header__brauerei">
            Brauerei Ponarth
            <button id="editPlace" class="edit-btn">
              <img src="./assets/edit.svg" alt="" class="edit-btn__img" />
            </button>
          </p>
          <p class="header__kaliningrad">
            Калининград
            <button id="editCity" class="edit-btn">
              <img src="./assets/edit.svg" alt="" class="edit-btn__img" />
            </button>
          </p>
        </div>
      </div>
    </div>

    <div class="scroll-container">
      <div class="scroll-container__video-wrapper">
        <div id="video-container">
          <video id="video" autoplay loop muted playsinline>
            <source
              src="https://cdn.cosmos.so/74eaa492-31ae-4550-b5a1-40917d873af5.mp4"
              type="video/mp4"
            />
          </video>
          <button id="editVideo" class="edit-btn">
            <img
              src="./assets/edit.svg"
              alt=""
              class="edit-btn__img edit-btn__img_light"
            />
          </button>
          <div class="video-overlay">
            <div class="video-overlay__caption">THOUGHT VESSEL 01</div>
            <button id="editCaption" class="edit-btn edit-btn__img_light">
              <img src="./assets/edit.svg" alt="" class="edit-btn__img" />
            </button>
            <div class="video-overlay__content">
              <h2 class="video-overlay__title">
                Clarity in Silence
                <button
                  id="editTitleContent"
                  class="edit-btn edit-btn__img_light"
                >
                  <img src="./assets/edit.svg" alt="" class="edit-btn__img" />
                </button>
              </h2>
              <p class="video-overlay__text">
                Design emerges from emptiness. Mental clarity precedes visual
                harmony.
                <button id="editPContent" class="edit-btn edit-btn__img_light">
                  <img src="./assets/edit.svg" alt="" class="edit-btn__img" />
                </button>
              </p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="spacer"></div>

    <div class="footer-content grid">
      <div class="footer-content__quote">
        <p>
          Trapped in the wisdom of certainty. Shuttered vision through the lens
          of anxiety. Judgment of the incomplete. Shadows of expectation. Urge
          of control even when creativity should be freed.
          <br /><br />
          Quiet the mind, and you will hear creativity speak. Feel the
          inspiration flowing through moments of stillness. Nourish your
          authentic expression by first emptying your cup.
          <button id="editQuote" class="edit-btn">
            <img src="./assets/edit.svg" alt="" class="edit-btn__img" />
          </button>
        </p>
      </div>
      <div class="divider"></div>
      <div class="footer-content__credits">
        <p class="footer-content__credit">
          A Way of Being
          <br />
          Through Mindful Creation
          <button id="editCredits" class="edit-btn">
            <img src="./assets/edit.svg" alt="" class="edit-btn__img" />
          </button>
        </p>
      </div>
    </div>

    <div class="mountain-footer">
      <video id="footerVideo" loop muted playsinline autoplay>
        <source
          src="https://cdn.cosmos.so/7f099da0-9ab2-49fd-879d-0bdfef258209.mp4"
          type="video/mp4"
        />
      </video>
      <button id="editFooterBg" class="edit-btn edit-btn__img_light">
        <img src="./assets/edit.svg" alt="" class="edit-btn__img" />
      </button>
      <div class="mountain-footer__contact-btn">
        <div class="mountain-footer__label">
          +Get In Touch
          <button id="editFooterLabel" class="edit-btn">
            <img
              src="./assets/edit.svg"
              alt=""
              class="edit-btn__img edit-btn__img_light"
            />
          </button>
        </div>
        <div class="mountain-footer__email-container email-container">
          <span class="email-container__left-bracket">[</span>
          <span class="email-container__email" id="email-copy"
            >hi@filip.fyi
            <button id="editFooterEmail" class="edit-btn edit-btn__img_light">
              <img
                src="./assets/edit.svg"
                alt=""
                class="edit-btn__img"
              /></button
          ></span>
          <span class="email-container__right-bracket">]</span>
        </div>
      </div>
    </div>
    <button id="editBackground" class="edit-btn edit-btn-bg">
      <img src="./assets/edit.svg" alt="" class="edit-btn__img" />
    </button>
    <div id="colorPanel" class="color-panel">
      <div class="color-panel__panel-header panel-header">
        <span>Выбрать цвет фона</span>
        <button class="color-panel__panel-close panel-close">&times;</button>
      </div>

      <div class="color-panel__panel-choose panel-choose">
        <div class="color-panel__bg">
          <input
            type="color"
            id="panelColorInput"
            class="color-panel__panel-input panel-input"
          />
          <button id="resetColorBg">Сбросить</button>
        </div>
        <span>Выбрать цвет элементов</span>
        <div class="color-panel-elements">
          <input
            type="color"
            id="panelColorElementsInput"
            class="color-panel__panel-input panel-input"
          />

          <button id="resetColorElements">Сбросить</button>
        </div>
      </div>
    </div>

    <div id="mediaPanel" class="media-panel">
      <div class="media-panel__panel-header panel-header">
        <span>Выбрать медиа</span>
        <button class="media-panel__panel-close panel-close">&times;</button>
      </div>
      <div class="media-panel__panel-choose_url panel-choose">
        <label for="panelUrlInput">Вставьте ссылку</label>
        <input
          type="url"
          id="panelUrlInput"
          placeholder="https://..."
          class="media-panel__panel-input_url panel-input"
        />
      </div>
      <div class="media-panel__panel-choose_file panel-choose">
        <label for="panelUrlInput">Или прикрепите медиа</label>
        <input
          type="file"
          id="panelFileInput"
          class="media-panel__panel-input_file panel-input"
          accept="image/*, video/*"
        />
      </div>
      <div class="media-panel__panel-actions">
        <button id="panelConfirm" class="media-panel__panel-btn">
          Применить
        </button>
      </div>
    </div>
    <script src="scripts/storage.js"></script>
    <script src="scripts/editors.js"></script>
    <script>
      const buttonEditBg = document.getElementById(`editBackground`);
      const panelColor = document.getElementById(`colorPanel`);
      const closeBtnColor = document.querySelector(`.color-panel__panel-close`);
      const bgColor = document.getElementById(`panelColorInput`);
      const elementColor = document.getElementById(`panelColorElementsInput`);

      const titleElement = document.querySelector('.header__title');
      const brauereiElement = document.querySelector('.header__brauerei');
      const kaliningradElement = document.querySelector('.header__kaliningrad');
      const resetColorElements = document.getElementById(`resetColorElements`);
      const resetColorBg = document.getElementById(`resetColorBg`);
      const logoElement = document.querySelector('.logo img');

      const togglePicBtn = document.getElementById('togglePic');
      const pumpkinIllustration = document.querySelector(
        '.header__illustration'
      );
      const headerContent = document.querySelector('.header');
      let isImageHidden = false;

      togglePicBtn.addEventListener('click', () => {
        isImageHidden = !isImageHidden;
        if (isImageHidden == true) {
          pumpkinIllustration.classList.add('hidden');
          togglePicBtn.innerHTML = '+';
          togglePicBtn.title = 'Показать изображение';
          headerContent.classList.add('image-hidden');
        } else {
          pumpkinIllustration.classList.remove('hidden');
          togglePicBtn.innerHTML = ' &mdash;';
          togglePicBtn.title = 'Скрыть изображение';

          headerContent.classList.remove('image-hidden');
        }
      });

      resetColorBg.addEventListener(`click`, () => {
        document.body.style.backgroundColor = `#f8f6f2`;
      });
      resetColorElements.addEventListener(`click`, () => {
        titleElement.style.color = `#f06a12`;
        brauereiElement.style.color = `#f06a12`;
        kaliningradElement.style.color = `#f06a12`;
        elementColor.value = '#f06a12';
        updateSvgFilter('#f06a12');
        logoElement.style.filter = 'url(#colorFilter)';
      });

      buttonEditBg.addEventListener(`click`, () => {
        if (panelColor.style.visibility === 'hidden') {
          panelColor.style.visibility = 'visible';
        } else {
          panelColor.style.visibility = 'hidden';
        }
      });
      elementColor.addEventListener(`change`, () => {
        let selectedColor = elementColor.value;
        titleElement.style.color = selectedColor;
        brauereiElement.style.color = selectedColor;
        kaliningradElement.style.color = selectedColor;
        logoElement.style.filter = `url(#colorFilter)`;
        updateSvgFilter(selectedColor);
      });

      function updateSvgFilter(color) {
        let svgFilter = document.getElementById('colorFilter');
        if (!svgFilter) {
          const svg = document.createElementNS(
            'http://www.w3.org/2000/svg',
            'svg'
          );
          svg.style.position = 'absolute';
          svg.style.width = '0';
          svg.style.height = '0';
          svgFilter = document.createElementNS(
            'http://www.w3.org/2000/svg',
            'filter'
          );
          svgFilter.id = 'colorFilter';
          svg.appendChild(svgFilter);
          document.body.appendChild(svg);
        }

        svgFilter.innerHTML = `
              <feFlood flood-color="${color}" result="flood"/>
              <feComposite in="flood" in2="SourceGraphic" operator="in"/>
          `;
      }

      closeBtnColor.addEventListener(`click`, () => {
        panelColor.style.visibility = 'hidden';
      });
      bgColor.addEventListener(`change`, () => {
        let selectedColor = bgColor.value;
        document.body.style.backgroundColor = selectedColor;
        bgColor.value = '#f8f6f2';
      });

      function isElementInViewport(el) {
        const rect = el.getBoundingClientRect();
        return (
          rect.top < window.innerHeight &&
          rect.bottom > 0 &&
          rect.left < window.innerWidth &&
          rect.right > 0
        );
      }

      function updateButtonVisibility(button, element) {
        if (
          isElementInViewport(element) &&
          !element.classList.contains('editing')
        ) {
          button.style.display = 'inline';
        } else {
          button.style.display = 'none';
        }
      }

      function setupButtonVisibility(button, element) {
        updateButtonVisibility(button, element);

        window.addEventListener('scroll', () =>
          updateButtonVisibility(button, element)
        );
        window.addEventListener('resize', () =>
          updateButtonVisibility(button, element)
        );
      }

      function makeEditable(buttonSelector, elementSelector) {
        const button = document.querySelector(buttonSelector);
        const element = document.querySelector(elementSelector);

        setupButtonVisibility(button, element);

        button.addEventListener('click', function Edit() {
          button.style.display = 'none';
          element.contentEditable = true;
          element.style.outline = '2px solid gray';
          element.style.outlineOffset = '2px';
          element.focus();
          element.classList.add('editing');
        });

        element.addEventListener('blur', function saveChange() {
          element.contentEditable = false;
          element.style.outline = 'none';
          element.style.outlineOffset = 'none';
          updateButtonVisibility(button, element);
          element.classList.remove('editing');
          updateButtonVisibility(button, element);
        });
      }

      let currentMediaElement = null;
      const panelMedia = document.getElementById('mediaPanel');
      const input = document.getElementById('panelUrlInput');
      const confirmBtn = document.getElementById('panelConfirm');
      const closeBtn = document.querySelector('.media-panel__panel-close');

      function showMediaPanel(mediaElement) {
        currentMediaElement = mediaElement;
        input.value = mediaElement.src || '';
        panelMedia.style.visibility = 'visible';
        panelMedia.style.opacity = '1';
        input.focus();
      }

      function hideMediaPanel() {
        panelMedia.style.opacity = '0';
        panelMedia.style.visibility = 'hidden';
        currentMediaElement = null;
      }

      function updateMedia() {
        const url = input.value.trim();
        const fileInput = document.getElementById('panelFileInput');

        if (fileInput.files.length > 0) {
          const file = fileInput.files[0];
          const fileURL = URL.createObjectURL(file);

          if (currentMediaElement.tagName === 'VIDEO') {
            currentMediaElement.innerHTML = `<source src="${fileURL}" type="${file.type}">`;
            currentMediaElement.load();
          } else {
            currentMediaElement.src = fileURL;
          }
        } else if (url && currentMediaElement) {
          if (currentMediaElement.tagName === 'VIDEO') {
            currentMediaElement.innerHTML = `<source src="${url}" type="video/mp4">`;
            currentMediaElement.load();
          } else {
            currentMediaElement.src = url;
          }
        }

        hideMediaPanel();
      }
      function makeMediaEditable(buttonSelector, mediaElementSelector) {
        const button = document.querySelector(buttonSelector);
        const mediaElement = document.querySelector(mediaElementSelector);

        setupButtonVisibility(button, mediaElement);

        button.addEventListener('click', () => {
          button.style.display = 'none';
          showMediaPanel(mediaElement);
        });
      }

      document.addEventListener('DOMContentLoaded', function () {
        elementColor.value = '#f06a12';
        bgColor.value = '#f8f6f2';

        updateSvgFilter('#f06a12');
        logoElement.style.filter = 'url(#colorFilter)';

        makeEditable('#editTitle', '.header__title');
        makeEditable('#editPlace', '.header__brauerei');
        makeEditable('#editCity', '.header__kaliningrad');
        makeEditable(`#editTitleContent`, `.video-overlay__title`);

        makeEditable(`#editPContent`, `.video-overlay__text`);
        makeEditable(`#editCaption`, `.video-overlay__caption`);
        makeEditable(`#editQuote`, `.footer-content__quote p`);

        makeEditable(`#editCredits`, `.footer-content__credit`);

        makeEditable(`#editFooterLabel`, `.mountain-footer__label`);
        makeEditable(`#editFooterEmail`, `.email-container__email`);
        // makeMediaEditable('#editLogo', '.logo img');
        makeMediaEditable('#editPic', '.header__illustration img');
        makeMediaEditable('#editVideo', '#video');
        makeMediaEditable(`#editFooterBg`, `#footerVideo`);

        panelConfirm.addEventListener('click', () => {
          updateMedia();
        });

        closeBtn.addEventListener('click', () => {
          hideMediaPanel();
        });
      });
    </script>

    <script>
      // Initialize Lenis for smooth scrolling
      const lenis = new Lenis({
        duration: 0.8,
        easing: t => Math.min(1, 1.001 - Math.pow(2, -10 * t)),
        orientation: 'vertical',
        gestureOrientation: 'vertical',
        smoothWheel: true,
      });

      // Register ScrollTrigger plugin
      gsap.registerPlugin(ScrollTrigger, CustomEase);

      // Sync Lenis with ScrollTrigger
      lenis.on('scroll', ScrollTrigger.update);

      gsap.ticker.add(time => {
        lenis.raf(time * 1000);
      });

      gsap.ticker.lagSmoothing(0);

      // Custom eases
      CustomEase.create('softReveal', '0.5, 0, 0, 1');
      CustomEase.create('smoothBlur', '0.25, 0.1, 0.25, 1');

      // Video animation
      const videoContainer = document.getElementById('video-container');
      const video = document.getElementById('video');
      const videoOverlay = document.querySelector('.video-overlay');
      const overlayCaption = document.querySelector('.video-overlay__caption');
      const overlayContent = document.querySelector(
        '.video-overlay .video-overlay__content'
      );
      const overlayTitle = document.querySelector('.video-overlay h2');
      const overlayTexts = document.querySelectorAll('.video-overlay p');
      const mountainFooter = document.querySelector('.mountain-footer');
      const footerVideo = document.querySelector('.mountain-footer video');

      // Email copy functionality
      const emailBtn = document.querySelector('.mountain-footer__contact-btn');
      const emailElement = document.getElementById('email-copy');
      const originalText = emailElement.textContent;
      let copyTimeout = null;

      // Listen for clicks on the contact button
      // emailBtn.addEventListener('click', function () {
      //   // Copy the email to clipboard
      //   navigator.clipboard
      //     .writeText(originalText)
      //     .then(function () {
      //       // Show success message
      //       emailElement.textContent = 'email copied to clipboard';

      //       // Clear any existing timeout
      //       if (copyTimeout) {
      //         clearTimeout(copyTimeout);
      //       }

      //       // Reset text after 2 seconds
      //       copyTimeout = setTimeout(function () {
      //         emailElement.textContent = originalText;
      //       }, 2000);
      //     })
      //     .catch(function (err) {
      //       console.error('Could not copy text: ', err);
      //     });
      // });

      // Ensure video plays
      video.play().catch(error => {
        console.log('Video play failed: ', error);
      });

      // Create timeline for video animation
      const tl = gsap.timeline({
        scrollTrigger: {
          trigger: '.scroll-container',
          start: 'top top',
          end: 'bottom bottom',
          scrub: 1.2,
          markers: false,
          onEnter: () => video.play(),
        },
      });

      // Create timeline for hero section animation with film roll effect
      const heroTl = gsap.timeline({
        scrollTrigger: {
          trigger: '.container',
          start: 'top top',
          end: 'top+=400 top',
          scrub: 1.2,
          markers: false,
        },
      });

      // Animate each element in the header content with a film roll effect
      gsap.utils.toArray('.header > *').forEach((element, index) => {
        heroTl.to(
          element,
          {
            rotationX: 90,
            y: -30,
            scale: 0.7,
            opacity: 0,
            filter: 'blur(4px)',
            ease: 'power3.inOut',
            transformOrigin: 'center top',
          },
          index * 0.08
        );
      });

      // Create a background overlay for darkening effect
      const overlay = document.createElement('div');
      overlay.style.position = 'absolute';
      overlay.style.top = '0';
      overlay.style.left = '0';
      overlay.style.width = '100%';
      overlay.style.height = '100%';
      overlay.style.backgroundColor = 'rgba(0,0,0,0)';
      overlay.style.pointerEvents = 'none';
      overlay.style.zIndex = '1';
      videoContainer.appendChild(overlay);

      // Animate video container with darkening overlay
      tl.to(
        videoContainer,
        {
          width: '90vw',
          height: '90vh',
          borderRadius: '0',
          ease: 'expo.out',
          duration: 0.5,
        },
        0
      )
        .to(
          video,
          {
            scale: 1.1,
            ease: 'expo.out',
            duration: 0.5,
          },
          0
        )
        .to(
          overlay,
          {
            backgroundColor: 'rgba(0,0,0,0.4)',
            ease: 'power3.inOut',
            duration: 0.5,
          },
          0
        )
        .to(
          videoOverlay,
          {
            clipPath: 'inset(0% 0 0 0)',
            backdropFilter: 'blur(8px)',
            ease: 'expo.out',
            duration: 0.3,
          },
          0.4
        )
        .to(
          overlayCaption,
          {
            transform: 'translateY(0)',
            ease: 'expo.out',
            duration: 0.3,
          },
          0.45
        )
        .to(
          overlayContent,
          {
            filter: 'blur(0px)',
            transform: 'scale(1)',
            ease: 'expo.out',
            duration: 0.4,
          },
          0.45
        );

      // Footer animation
      gsap.to(mountainFooter, {
        scrollTrigger: {
          trigger: '.footer-content',
          start: 'top 80%',
          end: 'top 40%',
          scrub: 1.2,
          onEnter: () => footerVideo.play(),
          markers: false,
        },
        clipPath: 'inset(0% 0 0 0)',
        ease: 'expo.out',
        duration: 1,
      });

      // Contact button animation in footer
      gsap.to('.mountain-footer .mountain-footer__contact-btn', {
        scrollTrigger: {
          trigger: '.mountain-footer',
          start: 'top 60%',
          end: 'top 40%',
          scrub: 0.8,
          markers: false,
        },
        opacity: 1,
        ease: 'expo.out',
        duration: 0.5,
      });

      // Text reveal animations
      gsap.utils.toArray('.footer-content p').forEach(text => {
        gsap.from(text, {
          scrollTrigger: {
            trigger: text,
            start: 'top 85%',
            end: 'top 70%',
            scrub: 1.2,
          },
          y: 15,
          filter: 'blur(5px)',
          ease: 'expo.out',
        });
      });
    </script>
  </body>
</html>
